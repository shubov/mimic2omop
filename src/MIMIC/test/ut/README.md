# MIMIC IV to OMOP CDM Conversion #

### Unit Tests Readme ###

#### Files in this folder ####

* gen_bq_ut_basic.conf
    * describes UT needed for the CDM tables
        * uniqueness for unique fields
        * foreign key integrity checks
* gen_bq_ut_basic.py
    * generates an sql script according to the config given
* ut_basic_gen.sql
    * the UT generated by the py script above
* ut_\<tablename\>.sql
    * UT which could not fit the automatic template, and has been written manually

#### How to run the tests ####

* Run a workflow:
    `python scripts/run_workflow.py -e conf/dev.etlconf -c conf/workflow_ut.conf`
        * edit `conf/workflow_ut.conf` accordingly
    for more details about workflows see README.md in the project root folder
* Run explicitly named scripts (space delimited):
    `python scripts/run_workflow.py -e conf/dev.etlconf -c conf/workflow_ut.conf test/ut/m_ut_person.sql`
    or
    `python scripts/bq_run_script.py -e conf/dev.etlconf test/ut/m_ut_person.sql`
* To see the result, run:
    `SELECT report_starttime, table_id, test_type, field_name
     FROM <metrics_dataset>.report_unit_test
     WHERE NOT test_passed;
    `

### Change Log (latest first) ###


**2021-01-26**

* generate_required_test() function is added
* inactivation flag for fields is added (see .conf)


**2021-01-19**

* This README is created
